# 前台服务权限修复说明

## 问题描述
应用在启动音乐服务时崩溃，错误日志显示：
```
java.lang.SecurityException: Permission Denial: startForeground from pid=9467, uid=10211 requires android.permission.FOREGROUND_SERVICE
```

## 问题原因
Android 9(API 28)及以上版本要求使用前台服务时必须声明相关权限：
- `android.permission.FOREGROUND_SERVICE` - 基本前台服务权限
- `android.permission.FOREGROUND_SERVICE_MEDIA_PLAYBACK` - 媒体播放前台服务权限

## 修复方案

### 1. 添加前台服务权限
在`AndroidManifest.xml`中添加以下权限声明：
```xml
<!-- 前台服务权限 -->
<uses-permission android:name="android.permission.FOREGROUND_SERVICE" />
<uses-permission android:name="android.permission.FOREGROUND_SERVICE_MEDIA_PLAYBACK" />
```

### 2. 配置服务前台类型
在`AndroidManifest.xml`中为音乐服务添加前台服务类型：
```xml
<service android:name=".MusicService"
    android:enabled="true"
    android:exported="false"
    android:foregroundServiceType="mediaPlayback" />
```

## 修复文件

1. **AndroidManifest.xml**
   - 添加前台服务权限声明
   - 配置音乐服务的前台服务类型

## 验证步骤

1. 重新构建项目：
   ```bash
   ./gradlew assembleDebug
   ```

2. 安装到设备：
   ```bash
   adb install -r app/build/outputs/apk/debug/app-debug.apk
   ```

3. 启动应用并验证：
   - 应用正常启动
   - 音乐服务正常启动
   - 前台通知正常显示
   - 无权限相关崩溃

## 兼容性说明

- **Android 4.4-8.1(API 19-27)**：无需特殊权限
- **Android 9+(API 28+)**：需要`FOREGROUND_SERVICE`权限
- **Android 10+(API 29+)**：媒体播放服务需要`FOREGROUND_SERVICE_MEDIA_PLAYBACK`权限

## 预期效果

- ✅ 应用在所有Android版本上正常启动
- ✅ 音乐服务可以正常启动为前台服务
- ✅ 前台通知正常显示
- ✅ 无权限相关崩溃或异常