# 领克02 CS11车机实体按键测试指南

## 问题描述
在领克02 CS11定制安卓4.4系统上，车机实体按键（播放/暂停、上一首、下一首）无法操作音乐应用。

## 修复方案
已完成以下兼容性修复：

### 1. 媒体会话管理器（安卓4.4兼容版）
- 使用`RemoteControlClient`替代`MediaSession`（API 21+）
- 注册媒体按钮事件接收器
- 支持播放状态同步

### 2. 车机按键接收器
- 创建专用`CarMediaButtonReceiver`处理实体按键
- 支持播放/暂停、上一首、下一首、停止功能
- 优先服务启动，失败时回退广播

### 3. 权限配置
- 添加蓝牙和媒体按钮相关权限
- 确保在安卓4.4系统上正常运行

## 测试步骤

### 方法1：使用测试Activity
1. 启动应用后，在应用列表中找到"车机按键测试"
2. 进入测试界面，点击各个测试按钮验证功能
3. 观察状态文本显示

### 方法2：直接测试实体按键
1. 确保音乐应用已启动并正在播放
2. 按下车机方向盘或中控台的实体按键
3. 观察音乐播放状态变化

### 方法3：ADB调试测试
```bash
# 连接车机（需要ADB调试权限）
adb connect 车机IP地址

# 模拟播放/暂停按键
adb shell am broadcast -a android.intent.action.MEDIA_BUTTON --es android.intent.extra.KEY_EVENT "KeyEvent{action=ACTION_DOWN, keyCode=KEYCODE_MEDIA_PLAY_PAUSE}"

# 模拟下一首按键
adb shell am broadcast -a android.intent.action.MEDIA_BUTTON --es android.intent.extra.KEY_EVENT "KeyEvent{action=ACTION_DOWN, keyCode=KEYCODE_MEDIA_NEXT}"

# 模拟上一首按键
adb shell am broadcast -a android.intent.action.MEDIA_BUTTON --es android.intent.extra.KEY_EVENT "KeyEvent{action=ACTION_DOWN, keyCode=KEYCODE_MEDIA_PREVIOUS}"
```

## 预期行为

| 按键操作 | 预期结果 |
|---------|----------|
| 播放/暂停 | 切换播放/暂停状态 |
| 下一首 | 播放下一首歌曲 |
| 上一首 | 播放上一首歌曲 |
| 停止 | 停止播放 |

## 故障排除

### 如果按键无响应
1. 检查应用是否已授予必要权限
2. 确认车机系统支持媒体按钮事件
3. 查看应用日志：`adb logcat | grep CarMediaButtonReceiver`

### 如果服务无法启动
1. 检查前台服务权限
2. 确认应用已添加到电池优化白名单
3. 尝试重启车机系统

### 日志关键词
- `CarMediaButtonReceiver`: 按键事件接收
- `CarMediaSessionManager`: 媒体会话管理
- `MusicService`: 音乐服务状态

## 兼容性说明

### 支持的安卓版本
- 安卓4.4 (API 19) - 完整支持
- 安卓5.0+ (API 21+) - 向后兼容

### 车机系统要求
- 支持标准媒体按钮事件
- 允许后台服务运行
- 支持音频焦点管理

## 联系方式
如有问题，请提供以下信息：
1. 车机系统版本
2. 具体按键无响应的情况
3. 应用日志输出