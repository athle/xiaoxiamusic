# 车机小组件尺寸适配指南

## 支持的尺寸规格

车机专用小组件支持以下尺寸规格：

### 横向布局 (宽x高)
- **2x1**: 120dp x 60dp - 最小尺寸，适合紧凑空间
- **2x2**: 120dp x 120dp - 标准尺寸，显示完整信息
- **2x4**: 120dp x 240dp - 大尺寸，显示专辑封面和完整控制
- **4x1**: 240dp x 60dp - 超宽尺寸，单行布局
- **4x2**: 240dp x 120dp - 宽屏标准，双列布局
- **4x4**: 240dp x 240dp - 最大尺寸，完整功能展示

### 实际像素换算
- 基于160dpi基准：1dp = 1px
- 240dpi屏幕：1dp = 1.5px
- 320dpi屏幕：1dp = 2px

## 自适应布局规则

### 尺寸检测逻辑
```kotlin
// 根据高度自适应显示内容
when {
    heightDp <= 80 -> {
        // 小尺寸：隐藏专辑封面，简化布局
        显示：歌曲名 + 基本控制按钮
    }
    heightDp <= 120 -> {
        // 中尺寸：显示专辑封面和标准控制
        显示：专辑封面 + 歌曲信息 + 完整控制
    }
    else -> {
        // 大尺寸：显示所有元素
        显示：专辑封面 + 歌曲信息 + 完整控制 + 打开应用按钮
    }
}
```

### 布局适配策略

#### 2x1 / 4x1 (单行模式)
- 隐藏专辑封面
- 横向排列：歌曲名 + 控制按钮
- 文字单行显示，自动省略
- 按钮紧凑排列

#### 2x2 / 4x2 (标准模式)
- 显示专辑封面 (48x48dp)
- 纵向排列：歌曲信息 + 控制按钮
- 文字双行显示，完整信息
- 按钮标准大小

#### 2x4 / 4x4 (完整模式)
- 显示专辑封面 (64x64dp)
- 完整歌曲信息展示
- 所有控制按钮
- 额外功能按钮（打开应用）

## 车机系统兼容性

### 领克02 CS11适配
- **推荐尺寸**：4x2 (240dp x 120dp)
- **最小尺寸**：2x1 (120dp x 60dp)
- **最大尺寸**：4x4 (240dp x 240dp)

### 其他车机系统
- 支持Android 4.4+ 所有版本
- 兼容不同屏幕密度
- 自适应不同分辨率

## 使用指南

### 添加小组件
1. 长按车机桌面空白处
2. 选择"车机音乐控制"小组件
3. 拖拽到合适位置
4. 调整尺寸到所需规格

### 尺寸调整
- **横向拖动**：调整宽度 (2格或4格)
- **纵向拖动**：调整高度 (1、2或4格)
- **实时预览**：调整时显示实际效果

### 最佳实践
- **中控屏幕**：使用4x2获得最佳体验
- **仪表盘**：使用2x1节省空间
- **副驾屏幕**：使用4x4完整功能

## 技术实现

### 尺寸计算
```kotlin
// 获取实际显示尺寸
val options = appWidgetManager.getAppWidgetOptions(appWidgetId)
val minWidth = options.getInt(AppWidgetManager.OPTION_APPWIDGET_MIN_WIDTH)
val minHeight = options.getInt(AppWidgetManager.OPTION_APPWIDGET_MIN_HEIGHT)
```

### 布局动态调整
- 使用RemoteViews实现动态布局
- 根据尺寸隐藏/显示元素
- 保持响应式交互

### 性能优化
- 最小更新频率 (0ms)
- 缓存布局计算结果
- 延迟加载专辑封面

## 故障排除

### 常见问题
1. **尺寸无法调整**：检查车机系统是否支持自由调整
2. **显示不全**：尝试增大尺寸规格
3. **点击无效**：确保权限设置正确

### 调试方法
```bash
# 查看小组件信息
adb shell dumpsys appwidget

# 检查尺寸参数
adb shell am broadcast -a com.maka.xiaoxia.action.UPDATE_CAR_WIDGET
```

## 版本更新记录
- v2.0：支持6种尺寸规格
- v1.5：增加自适应布局
- v1.0：基础车机适配